nv.models.multiChart=function(){function a(i){return i.each(function(x){var y=d3.select(this),z=this,A=(e||parseInt(y.style("width"))||960)-c.left-c.right,B=(f||parseInt(y.style("height"))||400)-c.top-c.bottom,C=x.filter(function(a){return!a.disabled&&"line"==a.type&&1==a.yAxis}),D=x.filter(function(a){return!a.disabled&&"line"==a.type&&2==a.yAxis}),E=x.filter(function(a){return!a.disabled&&"bar"==a.type&&1==a.yAxis}),F=x.filter(function(a){return!a.disabled&&"bar"==a.type&&2==a.yAxis}),G=x.filter(function(a){return!a.disabled&&"area"==a.type&&1==a.yAxis}),H=x.filter(function(a){return!a.disabled&&"area"==a.type&&2==a.yAxis}),I=x.filter(function(a){return!a.disabled&&1==a.yAxis}).map(function(a){return a.values.map(function(a){return{x:a.x,y:a.y}})}),J=x.filter(function(a){return!a.disabled&&2==a.yAxis}).map(function(a){return a.values.map(function(a){return{x:a.x,y:a.y}})});b.domain(d3.extent(d3.merge(I.concat(J)),function(a){return a.x})).range([0,A]);var K=y.selectAll("g.wrap.multiChart").data([x]),L=K.enter().append("g").attr("class","wrap nvd3 multiChart").append("g");L.append("g").attr("class","x axis"),L.append("g").attr("class","y1 axis"),L.append("g").attr("class","y2 axis"),L.append("g").attr("class","lines1Wrap"),L.append("g").attr("class","lines2Wrap"),L.append("g").attr("class","bars1Wrap"),L.append("g").attr("class","bars2Wrap"),L.append("g").attr("class","stack1Wrap"),L.append("g").attr("class","stack2Wrap"),L.append("g").attr("class","legendWrap");var M=K.select("g");g&&(u.width(A/2),M.select(".legendWrap").datum(x.map(function(a){return a.originalKey=void 0===a.originalKey?a.key:a.originalKey,a.key=a.originalKey+(1==a.yAxis?"":" (right axis)"),a})).call(u),c.top!=u.height()&&(c.top=u.height(),B=(f||parseInt(y.style("height"))||400)-c.top-c.bottom),M.select(".legendWrap").attr("transform","translate("+A/2+","+-c.top+")")),l.width(A).height(B).interpolate("monotone").color(x.map(function(a,b){return a.color||d[b%d.length]}).filter(function(a,b){return!x[b].disabled&&1==x[b].yAxis&&"line"==x[b].type})),m.width(A).height(B).interpolate("monotone").color(x.map(function(a,b){return a.color||d[b%d.length]}).filter(function(a,b){return!x[b].disabled&&2==x[b].yAxis&&"line"==x[b].type})),n.width(A).height(B).color(x.map(function(a,b){return a.color||d[b%d.length]}).filter(function(a,b){return!x[b].disabled&&1==x[b].yAxis&&"bar"==x[b].type})),o.width(A).height(B).color(x.map(function(a,b){return a.color||d[b%d.length]}).filter(function(a,b){return!x[b].disabled&&2==x[b].yAxis&&"bar"==x[b].type})),p.width(A).height(B).color(x.map(function(a,b){return a.color||d[b%d.length]}).filter(function(a,b){return!x[b].disabled&&1==x[b].yAxis&&"area"==x[b].type})),q.width(A).height(B).color(x.map(function(a,b){return a.color||d[b%d.length]}).filter(function(a,b){return!x[b].disabled&&2==x[b].yAxis&&"area"==x[b].type})),M.attr("transform","translate("+c.left+","+c.top+")");var N=M.select(".lines1Wrap").datum(C),O=M.select(".bars1Wrap").datum(E),P=M.select(".stack1Wrap").datum(G),Q=M.select(".lines2Wrap").datum(D),R=M.select(".bars2Wrap").datum(F),S=M.select(".stack2Wrap").datum(H),T=G.length?G.map(function(a){return a.values}).reduce(function(a,b){return a.map(function(a,c){return{x:a.x,y:a.y+b[c].y}})}).concat([{x:0,y:0}]):[],U=H.length?H.map(function(a){return a.values}).reduce(function(a,b){return a.map(function(a,c){return{x:a.x,y:a.y+b[c].y}})}).concat([{x:0,y:0}]):[];j.domain(d3.extent(d3.merge(I).concat(T),function(a){return a.y})).range([0,B]),k.domain(d3.extent(d3.merge(J).concat(U),function(a){return a.y})).range([0,B]),l.yDomain(j.domain()),n.yDomain(j.domain()),p.yDomain(j.domain()),m.yDomain(k.domain()),o.yDomain(k.domain()),q.yDomain(k.domain()),G.length&&d3.transition(P).call(p),H.length&&d3.transition(S).call(q),E.length&&d3.transition(O).call(n),F.length&&d3.transition(R).call(o),C.length&&d3.transition(N).call(l),D.length&&d3.transition(Q).call(m),r.ticks(A/100).tickSize(-B,0),M.select(".x.axis").attr("transform","translate(0,"+B+")"),d3.transition(M.select(".x.axis")).call(r),s.ticks(B/36).tickSize(-A,0),d3.transition(M.select(".y1.axis")).call(s),t.ticks(B/36).tickSize(-A,0),d3.transition(M.select(".y2.axis")).call(t),M.select(".y2.axis").style("opacity",J.length?1:0).attr("transform","translate("+b.range()[1]+",0)"),u.dispatch.on("legendClick",function(b){b.disabled=!b.disabled,x.filter(function(a){return!a.disabled}).length||x.map(function(a){return a.disabled=!1,K.selectAll(".series").classed("disabled",!1),a}),i.transition().call(a)}),v.on("tooltipShow",function(a){h&&w(a,z.parentNode)})}),a.update=function(){a(i)},a.container=this,a}var b,c={top:30,right:20,bottom:50,left:60},d=d3.scale.category20().range(),e=null,f=null,g=!0,h=!0,i=function(a,b,c){return"<h3>"+a+"</h3><p>"+c+" at "+b+"</p>"},b=d3.scale.linear(),j=d3.scale.linear(),k=d3.scale.linear(),l=nv.models.line().yScale(j),m=nv.models.line().yScale(k),n=nv.models.multiBar().stacked(!1).yScale(j),o=nv.models.multiBar().stacked(!1).yScale(k),p=nv.models.stackedArea().yScale(j),q=nv.models.stackedArea().yScale(k),r=nv.models.axis().scale(b).orient("bottom").tickPadding(5),s=nv.models.axis().scale(j).orient("left"),t=nv.models.axis().scale(k).orient("right"),u=nv.models.legend().height(30),v=d3.dispatch("tooltipShow","tooltipHide"),w=function(b,c){var d=b.pos[0]+(c.offsetLeft||0),e=b.pos[1]+(c.offsetTop||0),f=r.tickFormat()(l.x()(b.point,b.pointIndex)),g=(2==b.series.yAxis?t:s).tickFormat()(l.y()(b.point,b.pointIndex)),h=i(b.series.key,f,g,b,a);nv.tooltip.show([d,e],h,void 0,void 0,c.offsetParent)};return l.dispatch.on("elementMouseover.tooltip",function(a){a.pos=[a.pos[0]+c.left,a.pos[1]+c.top],v.tooltipShow(a)}),l.dispatch.on("elementMouseout.tooltip",function(a){v.tooltipHide(a)}),m.dispatch.on("elementMouseover.tooltip",function(a){a.pos=[a.pos[0]+c.left,a.pos[1]+c.top],v.tooltipShow(a)}),m.dispatch.on("elementMouseout.tooltip",function(a){v.tooltipHide(a)}),n.dispatch.on("elementMouseover.tooltip",function(a){a.pos=[a.pos[0]+c.left,a.pos[1]+c.top],v.tooltipShow(a)}),n.dispatch.on("elementMouseout.tooltip",function(a){v.tooltipHide(a)}),o.dispatch.on("elementMouseover.tooltip",function(a){a.pos=[a.pos[0]+c.left,a.pos[1]+c.top],v.tooltipShow(a)}),o.dispatch.on("elementMouseout.tooltip",function(a){v.tooltipHide(a)}),p.dispatch.on("tooltipShow",function(a){return Math.round(100*p.y()(a.point))?(a.pos=[a.pos[0]+c.left,a.pos[1]+c.top],void v.tooltipShow(a)):(setTimeout(function(){d3.selectAll(".point.hover").classed("hover",!1)},0),!1)}),p.dispatch.on("tooltipHide",function(a){v.tooltipHide(a)}),q.dispatch.on("tooltipShow",function(a){return Math.round(100*q.y()(a.point))?(a.pos=[a.pos[0]+c.left,a.pos[1]+c.top],void v.tooltipShow(a)):(setTimeout(function(){d3.selectAll(".point.hover").classed("hover",!1)},0),!1)}),q.dispatch.on("tooltipHide",function(a){v.tooltipHide(a)}),l.dispatch.on("elementMouseover.tooltip",function(a){a.pos=[a.pos[0]+c.left,a.pos[1]+c.top],v.tooltipShow(a)}),l.dispatch.on("elementMouseout.tooltip",function(a){v.tooltipHide(a)}),m.dispatch.on("elementMouseover.tooltip",function(a){a.pos=[a.pos[0]+c.left,a.pos[1]+c.top],v.tooltipShow(a)}),m.dispatch.on("elementMouseout.tooltip",function(a){v.tooltipHide(a)}),v.on("tooltipHide",function(){h&&nv.tooltip.cleanup()}),a.dispatch=v,a.lines1=l,a.lines2=m,a.bars1=n,a.bars2=o,a.stack1=p,a.stack2=q,a.xAxis=r,a.yAxis1=s,a.yAxis2=t,a.x=function(b){return arguments.length?(getX=b,l.x(b),n.x(b),a):getX},a.y=function(b){return arguments.length?(getY=b,l.y(b),n.y(b),a):getY},a.margin=function(b){return arguments.length?(c=b,a):c},a.width=function(b){return arguments.length?(e=b,a):e},a.height=function(b){return arguments.length?(f=b,a):f},a.color=function(b){return arguments.length?(d=b,u.color(b),a):d},a.showLegend=function(b){return arguments.length?(g=b,a):g},a.tooltips=function(b){return arguments.length?(h=b,a):h},a.tooltipContent=function(b){return arguments.length?(i=b,a):i},a};